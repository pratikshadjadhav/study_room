import{r as p,j as t,L as v}from"./index-DTs48n8C.js";import{E as R}from"./jspdf.es.min-DnEUcakV.js";const M=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}),h=(i=0)=>M.format(Number(i)||0);function C(i,c){const o=[i.map(n=>`"${String(n).replace(/"/g,'""')}"`).join(",")];return c.forEach(n=>{const l=n.map(m=>`"${String(m??"").replace(/"/g,'""')}"`).join(",");o.push(l)}),o.join(`
`)}function w(i,c,r="text/plain"){const o=new Blob([i],{type:r}),n=URL.createObjectURL(o),l=document.createElement("a");l.href=n,l.download=c,l.click(),URL.revokeObjectURL(n)}function _({filename:i,title:c,headers:r,rows:o}){const n=new R;n.setFontSize(14),n.text(c,14,18),n.setFontSize(10);let l=30;n.text(r.join(" | "),14,l),l+=8,o.forEach(m=>{const u=m.map(d=>String(d??"")).join(" | ");l>280&&(n.addPage(),l=20),n.text(u,14,l),l+=8}),n.save(i)}function A({seats:i=[],students:c=[],payments:r=[],expenses:o=[],plans:n=[]}){const l=p.useMemo(()=>{const e=new Map;return c.forEach(s=>e.set(s.id,s)),e},[c]),m=p.useMemo(()=>{const e=new Map;return n.forEach(s=>e.set(s.id,s)),e},[n]),u=p.useMemo(()=>i.slice().sort((e,s)=>e.seat_number.localeCompare(s.seat_number)).map(e=>{const s=e.current_student_id?l.get(e.current_student_id):null;return{id:e.id,seat:e.seat_number,status:e.status,student:s?s.name:"Unassigned"}}),[i,l]),d=p.useMemo(()=>o.slice().sort((e,s)=>new Date(s.expense_date||0).getTime()-new Date(e.expense_date||0).getTime()).map(e=>({id:e.id,title:e.title,category:e.category,date:e.expense_date?new Date(e.expense_date).toLocaleDateString("en-IN"):"Not set",amount:Number(e.amount)||0,paidVia:(e.paid_via||"cash").toUpperCase(),notes:e.notes||""})),[o]),x=p.useMemo(()=>r.slice().sort((e,s)=>new Date(s.payment_date||0).getTime()-new Date(e.payment_date||0).getTime()).map(e=>{const s=l.get(e.student_id),a=m.get(e.plan_id);return{id:e.id,date:e.payment_date?new Date(e.payment_date).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Not set",student:s?s.name:"Unknown",plan:a?a.name:"Custom",amount:Number(e.amount_paid)||0,mode:(e.payment_mode||"upi").toUpperCase(),validUntil:e.valid_until?new Date(e.valid_until).toLocaleDateString("en-IN"):"Not set",notes:e.notes||""}}),[r,l,m]),g=i.length||u.length,N=p.useMemo(()=>{const e=u.filter(j=>j.status==="occupied").length,s=Math.max(g-e,0),a=x.reduce((j,f)=>j+f.amount,0),b=d.reduce((j,f)=>j+f.amount,0);return{occupiedCount:e,availableCount:s,totalCollections:a,totalExpenses:b}},[u,x,d,g]),E=()=>{const e=x.map(a=>[a.date,a.student,a.plan,a.mode,a.amount,a.validUntil,a.notes]),s=C(["Date","Student","Plan","Mode","Amount","Valid Until","Notes"],e);w(s,"collections-report.csv","text/csv;charset=utf-8;")},D=()=>_({filename:"collections-report.pdf",title:"Collections Report",headers:["Date","Student","Plan","Mode","Amount","Valid Until"],rows:x.map(e=>[e.date,e.student,e.plan,e.mode,h(e.amount),e.validUntil])}),S=()=>{const e=d.map(a=>[a.date,a.title,a.category,a.paidVia,a.amount,a.notes]),s=C(["Date","Title","Category","Mode","Amount","Notes"],e);w(s,"expenses-report.csv","text/csv;charset=utf-8;")},U=()=>_({filename:"expenses-report.pdf",title:"Expenses Report",headers:["Date","Title","Category","Mode","Amount"],rows:d.map(e=>[e.date,e.title,e.category,e.paidVia,h(e.amount)])}),y=({title:e,description:s,onExportCsv:a,onExportPdf:b})=>t.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:e}),t.jsx("p",{className:"text-sm text-slate-500",children:s})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600",children:[t.jsx(v,{name:"fileDown",className:"h-4 w-4"}),"CSV"]}),t.jsxs("button",{onClick:b,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600",children:[t.jsx(v,{name:"fileText",className:"h-4 w-4"}),"PDF"]})]})]});return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("header",{className:"space-y-3",children:[t.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-slate-400",children:"Business Health"}),t.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Reports & Exports"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Download ready-to-share summaries for occupancy, collections, and expenses whenever you need them."})]}),t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Seats Occupied"}),t.jsx("p",{className:"mt-2 text-3xl font-semibold text-slate-900",children:N.occupiedCount}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Out of ",g," total seats"]})]}),t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Seats Available"}),t.jsx("p",{className:"mt-2 text-3xl font-semibold text-slate-900",children:N.availableCount}),t.jsx("p",{className:"text-xs text-slate-500",children:"Ready to be assigned"})]}),t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Collections"}),t.jsx("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:h(N.totalCollections)}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Across ",x.length," payments"]})]}),t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Expenses"}),t.jsx("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:h(N.totalExpenses)}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Across ",d.length," entries"]})]})]}),t.jsxs("section",{className:"rounded-3xl border border-slate-100 bg-white p-6 shadow-sm",children:[t.jsx(y,{title:"Collections Report",description:"All incoming fees, whether cash or UPI.",onExportCsv:E,onExportPdf:D}),t.jsx("div",{className:"mt-4 overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[t.jsx("thead",{className:"bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2",children:"Date"}),t.jsx("th",{className:"px-4 py-2",children:"Student"}),t.jsx("th",{className:"px-4 py-2",children:"Plan"}),t.jsx("th",{className:"px-4 py-2",children:"Mode"}),t.jsx("th",{className:"px-4 py-2",children:"Amount"}),t.jsx("th",{className:"px-4 py-2",children:"Valid Until"})]})}),t.jsxs("tbody",{className:"divide-y divide-slate-100",children:[x.map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-2 text-slate-600",children:e.date}),t.jsx("td",{className:"px-4 py-2 font-semibold text-slate-900",children:e.student}),t.jsx("td",{className:"px-4 py-2 text-slate-600",children:e.plan}),t.jsx("td",{className:"px-4 py-2 text-xs font-semibold uppercase text-indigo-600",children:e.mode}),t.jsx("td",{className:"px-4 py-2 font-semibold text-slate-900",children:h(e.amount)}),t.jsx("td",{className:"px-4 py-2 text-slate-600",children:e.validUntil})]},e.id)),x.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-sm text-slate-500",children:"No payments recorded yet. Use the Log Payment action to add your first collection."})}):null]})]})})]}),t.jsxs("section",{className:"rounded-3xl border border-slate-100 bg-white p-6 shadow-sm",children:[t.jsx(y,{title:"Expenses Report",description:"Track rent, upkeep, supplies, and every outgoing rupee.",onExportCsv:S,onExportPdf:U}),t.jsx("div",{className:"mt-4 overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[t.jsx("thead",{className:"bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2",children:"Date"}),t.jsx("th",{className:"px-4 py-2",children:"Title"}),t.jsx("th",{className:"px-4 py-2",children:"Category"}),t.jsx("th",{className:"px-4 py-2",children:"Mode"}),t.jsx("th",{className:"px-4 py-2",children:"Amount"})]})}),t.jsxs("tbody",{className:"divide-y divide-slate-100",children:[d.map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-2 text-slate-600",children:e.date}),t.jsx("td",{className:"px-4 py-2 font-semibold text-slate-900",children:e.title}),t.jsx("td",{className:"px-4 py-2 capitalize text-slate-600",children:e.category}),t.jsx("td",{className:"px-4 py-2 text-xs font-semibold uppercase text-rose-600",children:e.paidVia}),t.jsx("td",{className:"px-4 py-2 font-semibold text-slate-900",children:h(e.amount)})]},e.id)),d.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-sm text-slate-500",children:"No expenses logged yet. Use the Expenses screen to capture your spending."})}):null]})]})})]})]})}export{A as default};
