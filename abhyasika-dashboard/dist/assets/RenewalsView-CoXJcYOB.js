import{u as b,r as p,j as e,L as h}from"./index-DTs48n8C.js";function v({students:n,plans:i=[],onOpenModal:u}){const{hasPermission:g}=b(),j=g("payments","add"),w=p.useMemo(()=>{const t=new Map;return i.forEach(s=>t.set(s.id,s)),t},[i]),r=new Date,o=7,{upcoming:c,overdue:d,noPlan:x}=p.useMemo(()=>{const t={upcoming:[],overdue:[],noPlan:[]};return n.forEach(s=>{if(!s.renewal_date){t.noPlan.push(s);return}const a=new Date(s.renewal_date),l=Math.floor((a.setHours(0,0,0,0)-r.setHours(0,0,0,0))/(1e3*60*60*24));l<0?t.overdue.push(s):l<=o&&t.upcoming.push(s)}),t.upcoming.sort((s,a)=>new Date(s.renewal_date).getTime()-new Date(a.renewal_date).getTime()),t.overdue.sort((s,a)=>new Date(s.renewal_date).getTime()-new Date(a.renewal_date).getTime()),t.noPlan.sort((s,a)=>s.name.localeCompare(a.name)),t},[n,o,r]),f=[{label:"Due this week",value:c.length,tone:"bg-amber-50 text-amber-600",icon:"CalendarCheck"},{label:"Past due",value:d.length,tone:"bg-rose-50 text-rose-600",icon:"AlertTriangle"},{label:"No plan set",value:x.length,tone:"bg-slate-50 text-slate-600",icon:"CircleHelp"}],m=[...d.map(t=>({student:t,status:"Overdue",tone:"text-rose-600"})),...c.map(t=>({student:t,status:"Due soon",tone:"text-amber-600"})),...x.map(t=>({student:t,status:"No plan",tone:"text-slate-500"}))];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Renewals"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Monitor upcoming expiries and take action proactively."})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:f.map(t=>e.jsx("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:t.label}),e.jsx("p",{className:"text-2xl font-semibold text-slate-900",children:t.value})]}),e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-2xl ${t.tone}`,children:e.jsx(h,{name:t.icon,className:"h-5 w-5"})})]})},t.label))}),e.jsx("div",{className:"rounded-3xl border border-slate-100 bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto rounded-3xl",children:e.jsxs("table",{className:"min-w-[900px] w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Renewal Date"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold uppercase tracking-wide text-slate-500",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-sm text-slate-500",children:"All renewals look good. Great job!"})}):m.map(({student:t,status:s,tone:a})=>{const l=w.get(t.current_plan_id);return e.jsxs("tr",{className:"hover:bg-slate-50/60",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-slate-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-indigo-100 text-xs font-semibold text-indigo-600",children:t.name.slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{children:t.name}),e.jsx("p",{className:"text-xs text-slate-500",children:t.phone||t.email||"No contact"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:l?l.name:"Not set"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:t.renewal_date?new Date(t.renewal_date).toLocaleDateString():"â€”"}),e.jsx("td",{className:`px-4 py-3 text-sm font-semibold ${a}`,children:s}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-slate-600",children:j?e.jsxs("button",{onClick:()=>u("logPayment",{student:t}),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 transition hover:border-indigo-200 hover:text-indigo-600",children:[e.jsx(h,{name:"CreditCard",className:"h-3.5 w-3.5"}),"Log Payment"]}):e.jsx("span",{className:"text-xs text-slate-400",children:"No action"})})]},t.id)})})]})})})]})}export{v as default};
