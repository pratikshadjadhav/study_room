import{r as x,u as U,j as e,L as b}from"./index-DTs48n8C.js";function $({payments:N,students:j,plans:y,filters:a,onFiltersChange:m,onOpenModal:w,roles:v=[]}){const p=t=>{if(!t)return"";const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const n=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return`${n}-${l}-${r}`},_=t=>p(t)?new Date(t).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"—",M=t=>{const s=new Date(t);return Number.isNaN(s.getTime())?"—":s.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})},[u,P]=x.useState({key:"payment_date",direction:"desc"}),{hasPermission:I}=U(),L=I("payments","add"),d=x.useMemo(()=>{const t=new Map;return j.forEach(s=>t.set(s.id,s)),t},[j]),h=x.useMemo(()=>{const t=new Map;return y.forEach(s=>t.set(s.id,s)),t},[y]),E=x.useMemo(()=>{const t=new Map;return v.forEach(s=>t.set(s.id,s)),t},[v]),i=x.useMemo(()=>N.filter(t=>{var n;if(a.search){const l=d.get(t.student_id);if(!((n=l==null?void 0:l.name)==null?void 0:n.toLowerCase().includes(a.search.toLowerCase())))return!1}const s=p(t.payment_date);return!(a.startDate&&(!s||s<a.startDate)||a.endDate&&(!s||s>a.endDate)||a.mode&&a.mode!=="all"&&t.payment_mode!==a.mode)}).sort((t,s)=>{var k,C,D,S;const{key:n,direction:l}=u,r=l==="asc"?1:-1;if(n==="payment_date"){const o=p(t.payment_date),c=p(s.payment_date);return o.localeCompare(c)*r}if(n==="amount_paid")return(t.amount_paid-s.amount_paid)*r;if(n==="student"){const o=((k=d.get(t.student_id))==null?void 0:k.name)??"",c=((C=d.get(s.student_id))==null?void 0:C.name)??"";return o.localeCompare(c)*r}if(n==="plan"){const o=((D=h.get(t.plan_id))==null?void 0:D.name)??"",c=((S=h.get(s.plan_id))==null?void 0:S.name)??"";return o.localeCompare(c)*r}return 0}),[N,a,u,d,h]),R=i.reduce((t,s)=>t+s.amount_paid,0),T=i.filter(t=>t.includes_registration).reduce((t,s)=>t+s.amount_paid,0),g=t=>{P(s=>s.key===t?{key:t,direction:s.direction==="asc"?"desc":"asc"}:{key:t,direction:t==="payment_date"?"desc":"asc"})},f=t=>u.key!==t?null:e.jsx("span",{className:"ml-1 text-xs font-semibold text-indigo-500",children:u.direction==="asc"?"▲":"▼"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Payments"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Track revenue split by mode and registration fees."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>w("importData",{entity:"payments"}),className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-indigo-200 hover:text-indigo-600",children:[e.jsx(b,{name:"Upload",className:"h-4 w-4"}),"Import"]}),L?e.jsxs("button",{onClick:()=>w("logPayment"),className:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-indigo-500",children:[e.jsx(b,{name:"CreditCard",className:"h-4 w-4"}),"New Payment"]}):null]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Total Revenue"}),e.jsxs("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:["₹",R.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Registration Fees"}),e.jsxs("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:["₹",T.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"UPI Entries"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:i.filter(t=>t.payment_mode==="upi").length})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cash Entries"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:i.filter(t=>t.payment_mode==="cash").length})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-3 sm:flex-row",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx(b,{name:"search",className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",value:a.search,onChange:t=>m({...a,search:t.target.value}),placeholder:"Search by student name…",className:"w-full rounded-xl border border-slate-200 bg-slate-50 py-2 pl-9 pr-3 text-sm text-slate-700 outline-none transition focus:border-indigo-400 focus:bg-white focus:ring-2 focus:ring-indigo-100"})]}),e.jsxs("div",{className:"flex gap-3 sm:w-auto",children:[e.jsx("span",{children:"from"}),e.jsx("input",{type:"date",value:a.startDate,onChange:t=>m({...a,startDate:t.target.value}),className:"w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 outline-none transition focus:border-indigo-400 focus:bg-white focus:ring-2 focus:ring-indigo-100"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:a.endDate,onChange:t=>m({...a,endDate:t.target.value}),className:"w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 outline-none transition focus:border-indigo-400 focus:bg-white focus:ring-2 focus:ring-indigo-100"})]}),e.jsxs("select",{value:a.mode??"all",onChange:t=>m({...a,mode:t.target.value}),className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 outline-none transition focus:border-indigo-400 focus:bg-white focus:ring-2 focus:ring-indigo-100 sm:w-40",children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"cash",children:"Cash"})]})]}),e.jsxs("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:[i.length," records"]})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"cursor-pointer px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",onClick:()=>g("payment_date"),children:["Date",f("payment_date")]}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Time"}),e.jsxs("th",{className:"cursor-pointer px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",onClick:()=>g("student"),children:["Student",f("student")]}),e.jsxs("th",{className:"cursor-pointer px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",onClick:()=>g("plan"),children:["Plan",f("plan")]}),e.jsxs("th",{className:"cursor-pointer px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",onClick:()=>g("amount_paid"),children:["Amount Paid",f("amount_paid")]}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Mode"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Collected By"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Valid Until"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wide text-slate-500",children:"Notes"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold uppercase tracking-wide text-slate-500",children:"Receipt #"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-4 py-6 text-center text-sm text-slate-500",children:"No payment records match the current filters."})}):i.map((t,s)=>{const n=d.get(t.student_id),l=h.get(t.plan_id),r=E.get(t.collected_role_id);return e.jsxs("tr",{className:`hover:bg-slate-50/60 ${s%2===1?"bg-slate-50/40":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-slate-900",children:_(t.payment_date)}),e.jsx("td",{className:"px-4 py-3 text-xs font-medium text-slate-500",children:M(t.payment_date)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-600",children:[(n==null?void 0:n.name)||"Unknown student",e.jsx("div",{className:"text-xs text-slate-400",children:(n==null?void 0:n.phone)||""})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:(l==null?void 0:l.name)||"—"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-emerald-600",children:["₹",t.amount_paid.toLocaleString("en-IN"),t.includes_registration?e.jsx("span",{className:"ml-2 rounded-full bg-amber-50 px-2 py-0.5 text-xs font-semibold text-amber-600",children:"Reg."}):null]}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold ${t.payment_mode==="upi"?"bg-indigo-50 text-indigo-600":"bg-slate-100 text-slate-600"}`,children:t.payment_mode==="upi"?"UPI":"Cash"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:(r==null?void 0:r.name)||"Role not tagged"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:_(t.valid_until)}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:t.notes||"—"}),e.jsx("td",{className:"px-4 py-3 text-right text-xs font-semibold text-slate-500",children:t.id.slice(0,8).toUpperCase()})]},t.id)})})]})})]})]})}export{$ as default};
