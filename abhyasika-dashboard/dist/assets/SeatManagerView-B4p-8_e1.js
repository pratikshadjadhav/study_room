import{r as m,j as a}from"./index-DTs48n8C.js";import{E as g}from"./jspdf.es.min-DnEUcakV.js";const b={available:"border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 dark:border-emerald-500/30 dark:bg-emerald-500/10 dark:text-emerald-100 dark:hover:bg-emerald-500/20",occupied:"border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 dark:border-indigo-500/40 dark:bg-indigo-500/10 dark:text-indigo-100 dark:hover:bg-indigo-500/20",maintenance:"border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100 dark:border-amber-500/40 dark:bg-amber-500/10 dark:text-amber-100 dark:hover:bg-amber-500/20"},u=(n,o)=>{const s=[n.map(l=>`"${String(l).replace(/"/g,'""')}"`).join(",")];return o.forEach(l=>{const d=l.map(c=>`"${String(c??"").replace(/"/g,'""')}"`).join(",");s.push(d)}),s.join(`
`)},p=(n,o,i="text/plain")=>{const s=new Blob([n],{type:i}),l=URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=o,d.click(),URL.revokeObjectURL(l)},f=n=>{if(!n)return null;if(!n.renewal_date)return{label:"No plan",tone:"bg-slate-100 text-slate-600 dark:text-slate-300",accent:"ring-2 ring-slate-200 focus:ring-slate-300"};const o=new Date,i=new Date(n.renewal_date),s=Math.ceil((i.setHours(0,0,0,0)-o.setHours(0,0,0,0))/(1e3*60*60*24));return s<0?{label:"Expired",tone:"bg-rose-100 text-rose-700",accent:"ring-2 ring-rose-300 focus:ring-rose-400"}:s<=7?{label:`Due ${s===0?"today":`in ${s}d`}`,tone:"bg-amber-100 text-amber-700",accent:"ring-2 ring-amber-300 focus:ring-amber-400"}:null};function j({seats:n,students:o,onOpenModal:i}){const s=m.useMemo(()=>{const t=new Map;return o.forEach(e=>t.set(e.id,e)),t},[o]),l=m.useMemo(()=>n.map(t=>{const e=s.get(t.current_student_id);return{id:t.id,number:t.seat_number,status:t.status,studentName:(e==null?void 0:e.name)??"Unassigned",studentPhone:(e==null?void 0:e.phone)??"-",renewalDate:e!=null&&e.renewal_date?new Date(e.renewal_date).toLocaleDateString():"-"}}),[n,s]),d=()=>{const t=l.map(r=>[r.number,r.status,r.studentName,r.studentPhone,r.renewalDate]),e=u(["Seat","Status","Student","Phone","Renewal"],t);p(e,"seat-manager.csv","text/csv;charset=utf-8;")},c=()=>{const t=new g;t.setFontSize(14),t.text("Seat Manager Report",14,18),t.setFontSize(10);let e=30;t.text("Seat | Status | Student | Phone | Renewal",14,e),e+=8,l.forEach(r=>{const x=[r.number,r.status,r.studentName,r.studentPhone,r.renewalDate].join(" | ");e>280&&(t.addPage(),e=20),t.text(x,14,e),e+=8}),t.save("seat-manager.pdf")};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100",children:"Seat Manager"}),a.jsx("p",{className:"mt-1 text-sm text-slate-500 dark:text-slate-400",children:"Visualize seat allocation and handle assignments in real time."})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx("button",{onClick:d,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 dark:border-gray-700 px-3 py-2 text-sm font-semibold text-slate-600 dark:text-slate-300 transition hover:border-indigo-300 hover:text-indigo-600",children:"Export CSV"}),a.jsx("button",{onClick:c,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 dark:border-gray-700 px-3 py-2 text-sm font-semibold text-slate-600 dark:text-slate-300 transition hover:border-indigo-300 hover:text-indigo-600",children:"Export PDF"})]})]}),a.jsx("div",{className:"rounded-2xl border border-slate-100 dark:border-gray-800 bg-white dark:bg-gray-900 p-5 shadow-sm",children:a.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:n.map(t=>{const e=s.get(t.current_student_id),r=t.status==="occupied"?f(e):null;return a.jsxs("button",{onClick:()=>i(t.status==="available"?"assignSeat":"seatDetails",{seat:t,student:e}),className:`flex flex-col items-start rounded-2xl border px-4 py-4 text-left shadow-sm transition focus:outline-none ${b[t.status]??""} ${(r==null?void 0:r.accent)??"focus:ring-2 focus:ring-indigo-200"}`,children:[a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide text-slate-900 dark:text-slate-100",children:t.seat_number}),a.jsxs("div",{className:"flex items-center gap-2",children:[r?a.jsx("span",{className:`rounded-full px-2 py-0.5 text-[10px] font-semibold ${r.tone}`,children:r.label}):null,a.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-700 dark:text-slate-200",children:t.status})]})]}),a.jsx("div",{className:"mt-3 text-sm text-slate-700 dark:text-slate-200",children:t.status==="occupied"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"font-semibold",children:e==null?void 0:e.name}),a.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["Renewal:"," ",e!=null&&e.renewal_date?new Date(e.renewal_date).toLocaleDateString():"â€”"]})]}):t.status==="maintenance"?a.jsx("p",{className:"font-medium",children:"Under maintenance"}):a.jsx("p",{className:"font-medium text-emerald-700 dark:text-emerald-200",children:"Tap to assign"})})]},t.id)})})})]})}export{j as default};
