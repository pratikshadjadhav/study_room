import{r as l,j as e,L as y,s as b}from"./index-DTs48n8C.js";const m={students:"Students",payments:"Payments",seats:"Seats",expenses:"Expenses",expense_categories:"Expense categories",admin_roles:"Roles"};function N(){const[c,i]=l.useState([]),[j,d]=l.useState(!0),[x,p]=l.useState(""),[a,h]=l.useState({object_type:"all",search:""});l.useEffect(()=>{let t=!0;async function s(){d(!0),p("");let r=b.from("audit_log").select("*").order("created_at",{ascending:!1}).limit(200);a.object_type!=="all"&&(r=r.eq("object_type",a.object_type));const{data:o,error:n}=await r;t&&(n?(p(n.message??"Failed to fetch history."),i([])):i(o??[]),d(!1))}return s(),()=>{t=!1}},[a.object_type]);const u=l.useMemo(()=>{if(!a.search.trim())return c;const t=a.search.toLowerCase();return c.filter(s=>{const r=JSON.stringify(s.metadata||{}).toLowerCase();return s.action&&s.action.toLowerCase().includes(t)||s.object_type&&s.object_type.toLowerCase().includes(t)||r.includes(t)})},[c,a.search]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"History"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Recent changes across students, payments, seats, expenses, and roles."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:a.object_type,onChange:t=>h(s=>({...s,object_type:t.target.value})),className:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 outline-none transition focus:border-indigo-300 focus:ring-2 focus:ring-indigo-100",children:[e.jsx("option",{value:"all",children:"All types"}),Object.entries(m).map(([t,s])=>e.jsx("option",{value:t,children:s},t))]}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{name:"search",className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),e.jsx("input",{value:a.search,onChange:t=>h(s=>({...s,search:t.target.value})),placeholder:"Search action, type, metadata",className:"w-60 rounded-xl border border-slate-200 bg-white pl-9 pr-3 py-2 text-sm text-slate-700 outline-none transition focus:border-indigo-300 focus:ring-2 focus:ring-indigo-100"})]})]})]}),x?e.jsx("div",{className:"rounded-xl border border-rose-100 bg-rose-50 px-3 py-2 text-sm text-rose-700",children:x}):null,e.jsx("div",{className:"rounded-3xl border border-slate-100 bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto rounded-3xl pb-2",children:e.jsxs("table",{className:"min-w-[900px] w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Action"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Actor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Details"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"When"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:j?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-sm text-slate-500",children:"Loading history…"})}):u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-sm text-slate-500",children:"No history found for the current filters."})}):u.map(t=>{const s=t.created_at?new Date(t.created_at).toLocaleString():"",r=t.metadata||{},o=Object.entries(r).slice(0,3).map(([n,f])=>`${n}: ${String(f)}`).join(" • ");return e.jsxs("tr",{className:"hover:bg-slate-50/70",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-slate-900 capitalize",children:t.action}),e.jsx("td",{className:"px-4 py-3 text-slate-600",children:m[t.object_type]??t.object_type}),e.jsxs("td",{className:"px-4 py-3 text-slate-600",children:[t.actor_role?`${t.actor_role}`:"—",t.actor_id?e.jsxs("span",{className:"text-xs text-slate-400",children:[" • ",t.actor_id]}):null]}),e.jsx("td",{className:"px-4 py-3 text-slate-600 text-sm",children:o||"—"}),e.jsx("td",{className:"px-4 py-3 text-slate-500 text-xs",children:s})]},t.id)})})]})})})]})}export{N as default};
